# 事务
## 一、简介
关系型数据库必须遵循事务的四要性 ACID：
* Atomicity：**原子性**，即事务中的所有操作要么全部做完，要么都不做。只要有一个操作失败，整个事务就失败，就需要回滚
* Consistency：**一致性**，即数据库要一直处于一致的状态，事务的运行不会改变数据库原本的一致性约束。如有完整性约束a+b=10，如果一个事务改变了a，那么必须得改变b，使得事务结束后依然满足a+b=10，否则事务失败。
* Isolation：**隔离性**，即并发的事务之间不会互相影响，如果一个事务要访问的数据正在被另外一个事务修改，只要另外一个事务未提交，它所访问的数据就不受未提交事务的影响
* Durability：**持久性**，指一旦事务提交后，它所做的修改将会永久保存在数据库上

## 二、锁机制
### 2.1 死锁
当 2 个或多个工作各自具有某个资源的锁定，但其它工作尝试要锁定此资源，而造成工作永久封锁彼此时，会发生死锁。例如：
1. 事务 A 取得数据列 1 的共享锁定
2. 事务 B 取得数据列 2 的共享锁定
3. 事务 A 现在要求数据列 2 的独占锁定，但会被封锁直到事务 B 完成并释出对数据列 2 的共享锁定为止
4. 事务 B 现在要求数据列 1 的独占锁定，但会被封锁直到事务 A 完成并释出对数据列 1 的共享锁定为止

等到事务 B 完成后，事务 A 才能完成，但事务B 被事务 A 封锁了。这个状况也称为循环相依性。事务 A 相依于事务 B，并且事务 B
也因为相依于事务 A 而封闭了这个循环。

死锁解决办法：SQL Server 遇到死锁时会自动杀死其中一个事务，而另一个事务会正常结束（提交或回滚)
