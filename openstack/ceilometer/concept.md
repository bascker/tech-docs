# 基础概念
## resource：资源
被监控的资源对象，可以是一台虚拟机，一台物理机或者一块云硬盘，一个镜像。利用 _**ceilometer resource-list**_ 查看

```
$ ceilometer resource-list
+-----------------------------------------------------------------------+-----------+----------------------------------+----------------------------------+
| Resource ID                                                           | Source    | User ID                          | Project ID                       |
+-----------------------------------------------------------------------+-----------+----------------------------------+----------------------------------+
| 10.20.0.5                                                             | hardware  | None                             | None                             |
| 10.20.0.5.bond0                                                       | hardware  | None                             | None                             |
...
| 3f18e57a-d514-43a5-ae34-1fdaa56e2906                                  | openstack | None                             | 2212062c347d4687b5462d7f7c3003b8 |
| a134d60a-d056-4b2e-8fc1-780f16b56ec9                                  | openstack | fc94b27355794ec4bae358080278bb71 | 2212062c347d4687b5462d7f7c3003b8 |
+-----------------------------------------------------------------------+-----------+----------------------------------+----------------------------------+
```

> 注：hardware 表示云下物理机资源，openstack 表示云上资源

## Meter：计量项

资源使用的某个计量项，如内存占用，网络IO，磁盘IO等等。可以使用 _**ceilometer meter-list**_ 命令查看结果

```
$ ceilometer meter-list
+-------------------+------------+-----------+---------------------------------------+---------+-----------+
| Name              | Type       | Unit      | Resource ID                           | User ID | Project ID|
+-------------------+------------+-----------+---------------------------------------+---------+-----------+
| cpu               | cumulative | ns        | a134d60a-d056-4b2e-8fc1-780f16b56ec9  | ........| ..........|
| cpu.delta         | delta      | ns        | a134d60a-d056-4b2e-8fc1-780f16b56ec9  | ........| ..........|
| cpu_util          | gauge      | %         | a134d60a-d056-4b2e-8fc1-780f16b56ec9  | ........| ..........|
| disk.allocation   | gauge      | B         | a134d60a-d056-4b2e-8fc1-780f16b56ec9  | ........| ..........|
...
+-------------------+------------+-----------+---------------------------------------+---------+-----------+
```

> 客户端安装：yum install -y python-openstackclient python-neutronclient python2-ceilometerclient

## Sample：采样数据

指**某时刻**某个 _resource _的某个 _meter _的值，可利用 _**ceilometer sample-list**_ 命令查看

```
# 查看 cpu 的采样数据
$ ceilometer sample-list -m cpu
+--------------------------------------+------+------------+--------------+------+----------------------------+
| Resource ID                          | Name | Type       | Volume       | Unit | Timestamp                  |
+--------------------------------------+------+------------+--------------+------+----------------------------+
| a134d60a-d056-4b2e-8fc1-780f16b56ec9 | cpu  | cumulative | 3.116599e+13 | ns   | 2017-02-26T08:23:21.690000 |
| a134d60a-d056-4b2e-8fc1-780f16b56ec9 | cpu  | cumulative | 3.116301e+13 | ns   | 2017-02-26T08:22:21.397000 |
| a134d60a-d056-4b2e-8fc1-780f16b56ec9 | cpu  | cumulative | 3.116005e+13 | ns   | 2017-02-26T08:21:21.409000 |
| a134d60a-d056-4b2e-8fc1-780f16b56ec9 | cpu  | cumulative | 3.115702e+13 | ns   | 2017-02-26T08:20:21.418000 |
...
+--------------------------------------+------+------------+--------------+------+----------------------------+

# 查看某资源的采样数据
$ ceilometer sample-list -q 'resource=e82ef564-c48a-4e50-ae2f-9747f5145799'
+--------------------------------------+--------------------------------------+----------------+-------+------------+-------+----------------------------+
| ID                                   | Resource ID                          | Name           | Type  | Volume     | Unit  | Timestamp                  |
+--------------------------------------+--------------------------------------+----------------+-------+------------+-------+----------------------------+
| eb42cffa-d189-11e6-a293-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.serve    | delta | 13287936.0 | B     | 2017-01-03T07:54:56.867840 |
| eb42ddec-d189-11e6-a293-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.download | delta | 13287936.0 | B     | 2017-01-03T07:54:56.867840 |
| e5eedef4-d189-11e6-a703-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.size     | gauge | 13287936.0 | B     | 2017-01-03T07:54:47.973874 |
| e5dfde9a-d189-11e6-a703-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image          | gauge | 1.0        | image | 2017-01-03T07:54:47.875333 |
| d65694fa-d189-11e6-8353-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.size     | gauge | 13287936.0 | B     | 2017-01-03T07:54:21.782833 |
| d6547724-d189-11e6-b263-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.size     | gauge | 13287936.0 | B     | 2017-01-03T07:54:21.781040 |
| d64bca0c-d189-11e6-a2d1-00505686147f | e82ef564-c48a-4e50-ae2f-9747f5145799 | image.size     | gauge | 13287936.0 | B     | 2017-01-03T07:54:21.685279 |
+--------------------------------------+--------------------------------------+----------------+-------+------------+-------+----------------------------+
```

> -q 选项：有效的 key：\['message\_id', 'meter', 'project', 'resource', 'search\_offset', 'source', 'timestamp', 'user'\]

_**Sample**_ 的收集有区间概念，即收集数据的时间间隔.默认设置为 _**600s**_，即 _**10min**_。在 _**pipeline.yaml**_ 中定义如下：

```
$ vim pipeline.yaml
---
sources:
    - name: meter_source
      interval: 600
      meters:
          - "*"
      sinks:
          - meter_sink
...
```

## Statistics：统计

一个时间段内的 meter 的平均值，包括计数、最大、最小、平均、求和等

```
# 对 meter 项 cpu 的统计
$ ceilometer statistics -m cpu
+--------+----------------------------+----------------------------+--------------+-------------+-------------------+-----------------+-------+-----------+----------------------------+----------------------------+
| Period | Period Start               | Period End                 | Max          | Min         | Avg               | Sum             | Count | Duration  | Duration Start             | Duration End               |
+--------+----------------------------+----------------------------+--------------+-------------+-------------------+-----------------+-------+-----------+----------------------------+----------------------------+
| 0      | 2017-02-25T08:44:43.176000 | 2017-02-26T08:34:21.595000 | 3.119868e+13 | 2.68998e+13 | 2.90662229937e+13 | 4.136123532e+16 | 1423  | 85771.093 | 2017-02-25T08:44:50.502000 | 2017-02-26T08:34:21.595000 |
+--------+----------------------------+----------------------------+--------------+-------------+-------------------+-----------------+-------+-----------+----------------------------+----------------------------+
```